<div class="container-fluid mt-4">
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h1 class="h3 text-primary mb-1">
        <i class="bi bi-bug-fill me-2"></i>Issue Tracker
      </h1>
      <p class="text-muted mb-0">Manage and track your project issues efficiently</p>
    </div>
    <button class="btn btn-primary" (click)="onCreateIssue()">
      <i class="bi bi-plus-circle me-2"></i>Create Issue
    </button>
  </div>

  <!-- Filters Card -->
  <div class="card shadow-sm mb-4">
    <div class="card-body p-3">
      <div class="row g-3 align-items-end">
        <!-- Search -->
        <div class="col-md-3">
          <label class="form-label fw-semibold">Search Issues</label>
          <div class="input-group">
            <span class="input-group-text bg-light border-end-0">
              <i class="bi bi-search text-muted"></i>
            </span>
            <input type="text" class="form-control border-start-0" 
                   placeholder="Search by title..." 
                   [(ngModel)]="searchTerm" 
                   (input)="onSearch()">
          </div>
        </div>

        <!-- Status Filter -->
        <div class="col-md-2">
          <label class="form-label fw-semibold">Status</label>
          <select class="form-select" [(ngModel)]="statusFilter" (change)="onFilterChange()">
            <option value="">All Status</option>
            <option *ngFor="let status of statusOptions" [value]="status">
              {{ status | titlecase }}
            </option>
          </select>
        </div>

        <!-- Priority Filter -->
        <div class="col-md-2">
          <label class="form-label fw-semibold">Priority</label>
          <select class="form-select" [(ngModel)]="priorityFilter" (change)="onFilterChange()">
            <option value="">All Priority</option>
            <option *ngFor="let priority of priorityOptions" [value]="priority">
              {{ priority | titlecase }}
            </option>
          </select>
        </div>

        <!-- Assignee Filter -->
        <div class="col-md-2">
          <label class="form-label fw-semibold">Assignee</label>
          <select class="form-select" [(ngModel)]="assigneeFilter" (change)="onFilterChange()">
            <option value="">All Assignees</option>
            <option *ngFor="let assignee of uniqueAssignees" [value]="assignee">
              {{ assignee }}
            </option>
            <option value="unassigned">Unassigned</option>
          </select>
        </div>

        <!-- Items per page -->
        <div class="col-md-2">
          <label class="form-label fw-semibold">Items per page</label>
          <select class="form-select" [(ngModel)]="pageSize" (change)="onFilterChange()">
            <option value="5">5</option>
            <option value="10" selected>10</option>
            <option value="20">20</option>
            <option value="50">50</option>
          </select>
        </div>

        <!-- Clear Filters Button - FIXED POSITION -->
        <div class="col-md-1">
          <label class="form-label fw-semibold" style="visibility: hidden;">Clear</label>
          <button class="btn w-100" 
                  [class.btn-primary]="hasActiveFilters()"
                  [class.btn-outline-secondary]="!hasActiveFilters()"
                  (click)="clearFilters()" 
                  [disabled]="!hasActiveFilters()"
                  title="Clear all search and filters">
            <i class="bi bi-arrow-clockwise me-1"></i>
            Clear
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Issues Table Card -->
  <div class="card shadow-sm">
    <div class="card-header bg-light d-flex justify-content-between align-items-center py-3">
      <h5 class="mb-0 fw-semibold">
        <i class="bi bi-list-task me-2"></i>Issues 
        <span class="badge bg-primary ms-2">{{ totalItems }}</span>
      </h5>
      <div class="text-muted small">
        Showing {{ issues.length }} of {{ totalItems }} issues
      </div>
    </div>
    
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead class="table-light">
            <tr>
              <th width="80" (click)="onSort('id')" class="sortable-header">
                <div class="d-flex align-items-center">
                  <span>ID</span>
                  <i class="bi ms-1" [ngClass]="getSortIcon('id')"></i>
                </div>
              </th>
              <th (click)="onSort('title')" class="sortable-header">
                <div class="d-flex align-items-center">
                  <span>Title</span>
                  <i class="bi ms-1" [ngClass]="getSortIcon('title')"></i>
                </div>
              </th>
              <th width="120" (click)="onSort('status')" class="sortable-header">
                <div class="d-flex align-items-center">
                  <span>Status</span>
                  <i class="bi ms-1" [ngClass]="getSortIcon('status')"></i>
                </div>
              </th>
              <th width="120" (click)="onSort('priority')" class="sortable-header">
                <div class="d-flex align-items-center">
                  <span>Priority</span>
                  <i class="bi ms-1" [ngClass]="getSortIcon('priority')"></i>
                </div>
              </th>
              <th width="200" (click)="onSort('assignee')" class="sortable-header">
                <div class="d-flex align-items-center">
                  <span>Assignee</span>
                  <i class="bi ms-1" [ngClass]="getSortIcon('assignee')"></i>
                </div>
              </th>
              <th width="180" (click)="onSort('updated_at')" class="sortable-header">
                <div class="d-flex align-items-center">
                  <span>Updated</span>
                  <i class="bi ms-1" [ngClass]="getSortIcon('updated_at')"></i>
                </div>
              </th>
              <th width="120" class="text-center">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let issue of issues" 
                (click)="onIssueClick(issue, $event)" 
                class="issue-row">
              <td class="fw-bold text-muted">#{{ issue.id }}</td>
              <td>
                <div class="fw-semibold text-dark">{{ issue.title }}</div>
                <small class="text-muted" *ngIf="issue.description">
                  {{ issue.description }}
                </small>
              </td>
              <td>
                <span class="badge d-inline-flex align-items-center" 
                      [ngClass]="getStatusBadgeClass(issue.status)">
                  <i class="bi me-1" [ngClass]="{
                    'bi-circle': issue.status === 'open',
                    'bi-arrow-clockwise': issue.status === 'in_progress', 
                    'bi-check-circle': issue.status === 'closed'
                  }"></i>
                  {{ issue.status | titlecase }}
                </span>
              </td>
              <td>
                <span class="badge d-inline-flex align-items-center" 
                      [ngClass]="getPriorityBadgeClass(issue.priority)">
                  <i class="bi me-1" [ngClass]="{
                    'bi-arrow-down': issue.priority === 'low',
                    'bi-dash': issue.priority === 'medium',
                    'bi-arrow-up': issue.priority === 'high',
                    'bi-exclamation-triangle': issue.priority === 'urgent'
                  }"></i>
                  {{ issue.priority | titlecase }}
                </span>
              </td>
              <td>
                <div class="d-flex align-items-center">
                  <i class="bi bi-person-circle text-muted me-2"></i>
                  <span [class.text-muted]="!issue.assignee">
                    {{ issue.assignee || 'Unassigned' }}
                  </span>
                </div>
              </td>
              <td class="text-muted">
                <small>{{ issue.updated_at | date:'MMM d, y, h:mm a' }}</small>
              </td>
              <td class="text-center">
                <button class="btn btn-sm btn-outline-primary btn-edit" 
                        (click)="onEditIssue(issue, $event)"
                        title="Edit Issue">
                  <i class="bi bi-pencil"></i>
                </button>
              </td>
            </tr>
            <tr *ngIf="issues.length === 0">
              <td colspan="7" class="text-center py-5 text-muted">
                <i class="bi bi-inbox display-4 d-block mb-2"></i>
                No issues found
                <div class="small mt-1" *ngIf="hasActiveFilters()">
                  Try adjusting your filters or search terms
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Pagination -->
    <div class="card-footer bg-light" *ngIf="totalPages > 1">
      <div class="d-flex justify-content-between align-items-center">
        <div class="text-muted small">
          Page {{ currentPage + 1 }} of {{ totalPages }}
        </div>
        <nav>
          <ul class="pagination pagination-sm mb-0">
            <li class="page-item" [class.disabled]="currentPage === 0">
              <a class="page-link" (click)="onPageChange(currentPage - 1)" style="cursor: pointer;">
                Previous
              </a>
            </li>
            
            <li class="page-item" *ngFor="let page of getVisiblePages()" 
                [class.active]="page === currentPage">
              <a class="page-link" (click)="onPageChange(page)" style="cursor: pointer;">
                {{ page + 1 }}
              </a>
            </li>
            
            <li class="page-item" [class.disabled]="currentPage === totalPages - 1">
              <a class="page-link" (click)="onPageChange(currentPage + 1)" style="cursor: pointer;">
                Next
              </a>
            </li>
          </ul>
        </nav>
      </div>
    </div>
  </div>
</div>

<!-- Create Issue Modal -->
<div class="modal fade" [class.show]="showCreateForm" style="display: block;" *ngIf="showCreateForm">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Create New Issue</h5>
        <button type="button" class="btn-close" (click)="onCloseCreateForm()"></button>
      </div>
      <div class="modal-body">
        <app-issue-form 
          (issueCreated)="onIssueCreated()"
          (cancel)="onCloseCreateForm()">
        </app-issue-form>
      </div>
    </div>
  </div>
</div>
<div class="modal-backdrop fade show" *ngIf="showCreateForm" (click)="onCloseCreateForm()"></div>

<!-- Issue Detail Modal -->
<div class="modal fade" [class.show]="showDetail" style="display: block;" *ngIf="showDetail">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Issue Details</h5>
        <button type="button" class="btn-close" (click)="onCloseDetail()"></button>
      </div>
      <div class="modal-body">
        <app-issue-detail 
          *ngIf="selectedIssue"
          [issue]="selectedIssue"
          (issueUpdated)="onIssueUpdated()"
          (close)="onCloseDetail()">
        </app-issue-detail>
      </div>
    </div>
  </div>
</div>
<div class="modal-backdrop fade show" *ngIf="showDetail" (click)="onCloseDetail()"></div>
